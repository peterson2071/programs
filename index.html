<!DOCTYPE html>
<html lang=en>
  <head>
    <meta name=viewport content="initial-scale=1, width=device-width" >
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <script src="./index.js"></script>

    <title>healthlocation</title>
    <style media="screen">
    #map {
height: 100%;
}

/* Optional: Makes the sample page fill the window. */
body {
height: 100%;
margin: 0;
padding: 0;
}
    </style>
  </head>

<body>
  <nav class="navbar navbar-expand-md navbar-light bg-light border">
    <div class="collapse navbar-collapse" id=navbar>
      {% if session.user_id %}
        <ul class="navbar-nav ml-auto mt-2">
          <li class=nav-item><a class=nav-link href=/buy>Buy</a></li>
          <li class=nav-item><a class=nav-link href=/history>History</a></li>
        </ul>
        <ul class="navbar-nav ml-auto mt-2">
          <li class=nav-item><a class=nav-link href=/logout>Log Out</a></li>
        </ul>
      {% else %}
        <ul class="navbar-nav ml-auto mt-2">
          <li class=nav-item><a class=nav-link href=/login>Log In</a></li>
          <li class=nav-item><a class=nav-link href=/register>Register</a></li>
        </ul>
      {% endif %}
    </div>
  </nav>
    <div id="map"></div>

        <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
        <script type="text/javascript">
        // Note: This example requires that you consent to location sharing when
        // prompted by your browser. If you see the error "The Geolocation service
        // failed.", it means you probably did not give permission for the browser to
        // locate you.
        let map, infoWindow;

        function initMap() {
          map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: -34.397, lng: 150.644 },
            zoom: 6,
          });
          infoWindow = new google.maps.InfoWindow();

          const locationButton = document.createElement("button");

          locationButton.textContent = "Pan to Current Location";
          locationButton.classList.add("custom-map-control-button");
          map.controls[google.maps.ControlPosition.TOP_CENTER].push(locationButton);
          locationButton.addEventListener("click", () => {
            // Try HTML5 geolocation.
            if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(
                (position) => {
                  const pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude,
                  };

                  infoWindow.setPosition(pos);
                  infoWindow.open(map);
                  map.setCenter(pos);
                  var drugstores = new google.maps.places.PlacesService(map);
                  var request = {
                    location: new google.maps.LatLng(position.coords.latitude, position.coords.longitude),
                    radius: 10000,
                    keyword: "pharmacy"
                  };
                  service.search(request, callback);
                },
                () => {
                  handleLocationError(true, infoWindow, map.getCenter());
                }
              );
            } else {
              // Browser doesn't support Geolocation
              handleLocationError(false, infoWindow, map.getCenter());
            }
          });
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          infoWindow.setPosition(pos);
          infoWindow.setContent(
            browserHasGeolocation
              ? "Error: The Geolocation service failed."
              : "Error: Your browser doesn't support geolocation."
          );
          infoWindow.open(map);
        }
        </script>

        <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDTW5FL1YXhx8bSQqYEUlcyU-vxGve3nTs&callback=initMap&v=weekly"
      async
    ></script>
</body>
</html>
